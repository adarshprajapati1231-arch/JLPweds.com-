import Head from 'next/head'
import { supabase } from '../lib/supabaseClient'

export default function Home({ vendorCategoriesJSON }) {
  return (
    <>
      <Head>
        <title>JLPweds — Premium Wedding Services</title>
        <meta name="description" content="JLPweds — Premium wedding services in Jalalpur & Ambedkar Nagar" />
      </Head>

      <div dangerouslySetInnerHTML={{__html: "<!doctype html>\n\n<html lang=\"en\">\n    \n    \n<head>\n    <meta charset=\"utf-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=0.6\" />\n<title>JLPweds \u2014 Premium Wedding Services</title>\n\n<meta name=\"description\" content=\"JLPweds \u2014 Premium wedding services: tents, cars, decor, catering, photography. Book via WhatsApp with a prefilled message.\" />\n\n<meta name=\"keywords\" content=\"car booking near Jalalpur, DJ booking near me, tent booking in Ambedkar Nagar, wedding car booking in Akbarpur, DJ wale Jalalpur me, shadi tent booking, marriage hall booking Jalalpur, event booking Ambedkar Nagar, light sound booking Akbarpur, band baja booking near me\">\n\n\n<link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n<link href=\"https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap\" rel=\"stylesheet\">\n\n<link href=\"https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap\" rel=\"stylesheet\">\n\n\n\n<link rel=\"stylesheet\" href=\"./style.css\">\n\n<link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"assets/images/favicon.png\" />\n\n<link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"assets/images/favicon.png\">\n\n\n<meta name=\"theme-color\" content=\"#7A1E24\" />\n\n<meta name=\"msapplication-navbutton-color\" content=\"#7A1E24\" />\n\n<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"#7A1E24\" />\n<meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n\n</head>\n\n\n\n\n<body>\n<header>\n<div class=\"logo\">\n<div>\n<img src=\"assets/images/logo.png\" alt=\"logo\" height=\"50\" class=\"round-logo\">\n</div>\n\n\n<div style=\"position:absolute; left:-9999px;\">\n  DJ booking in Jalalpur, car booking near me, tent booking in Ambedkar Nagar,\n  light and sound DJ near Tanda, marriage car booking in Akbarpur,\n  JLPweds best wedding services in Uttar Pradesh.\n</div>\n\n<div>\n<div style=\"font-size:15px\">\nJLPweds\n</div>\n<div style=\"font-size:8px;color:var(--muted)\">\nPremium Wedding Services\n</div>\n</div>\n</div>\n<nav>\n<a href=\"#home\">Home</a>\n<a href=\"#services\">Services</a>\n<a href=\"#book\" id=\"bookTop\">Book</a>\n</nav>\n</header>\n\n\n\n<main>\n<section class=\"hero\" id=\"home\">\n<div class=\"hero-inner\">\n<div class=\"eyebrow\">\nOUR SERVICES\n</div>\n<h1>Premium Wedding Services</h1>\n<p class=\"lead\">\nBook our comprehensive range of wedding services. Each card represents a curated service from our premium catalogue \u2014 elegant, minimal and easy to book.\n</p>\n<div class=\"search-row\">\n<input type=\"search\" id=\"searchInput\" placeholder=\"Search services, e.g. 'car', 'photography'\" aria-label=\"Search services\">\n</div>\n<div class=\"category-pills\" id=\"pills\"></div>\n</div>\n</section>\n<section class=\"section\" id=\"services\">\n<h2 id=\"current-title\">OUR SERVICES</h2>\n<div class=\"grid\" id=\"cards\"></div>\n<button id=\"back-to-categories\" class=\"btn hidden\" style=\"display:block;margin:20px auto 0;\">\u2190 Back to Categories</button>\n</section>\n\n\n\n<section class=\"vendor-cta-new\">\n  <div class=\"cta-inner-box\">\n    <p class=\"cta-message\">\n      \u2b50 **Attention Vendors!** \u2b50<br>\n      Are you a premium service provider in **Cars, Tents, Halls, or Photography**? Join the JLPweds network today to reach thousands of potential clients.\n    </p>\n    <a href=\"https://registerjlpwedsvendor.netlify.app\" target=\"_blank\" class=\"cta-register-btn\">\n      REGISTER YOUR SERVICE NOW \u2192\n    </a>\n  </div>\n</section>\n<section class=\"section\" id=\"services\">\n<h2 id=\"current-title\"></h2>\n\n    \n</section>\n\n\n\n</main> \n<div class=\"modal-backdrop\" id=\"modalBackdrop\" role=\"dialog\" aria-modal=\"true\">\n<div class=\"modal\" role=\"document\">\n<button id=\"closeModal\" style=\"float:right;background:transparent;border:none;font-size:16px;cursor:pointer\">\u2715</button>\n<h3>Book Service</h3>\n<p class=\"small\">\nService: <span id=\"modalServiceTitle\" style=\"font-weight:600;color:var(--maroon)\"></span> <span class=\"muted\">(<span id=\"modalServiceId\"></span>)</span>\n</p>\n<div id=\"imageGallery\" style=\"display:flex;gap:8px;overflow-x:auto;padding-bottom:10px;margin-bottom:15px\">\n</div>\n<p style=\"font-size:13px; margin-top:0;\">\n    Vendor: <span id=\"modalVendorName\" style=\"font-weight:600;color:var(--heading)\">N/A</span> | \n    Price: <span id=\"modalPriceDisplay\" style=\"font-weight:600;color:var(--maroon)\"></span>\n</p>\n<p id=\"modalServiceDesc\" style=\"font-size:12px; margin-top:-5px; margin-bottom:10px;\"></p>\n\n<div id=\"carCalcContainer\" class=\"hidden\" style=\"margin-bottom: 10px;\">\n  <button id=\"openCalcBtn\" class=\"btn\" type=\"button\">Calculate Price Per KM</button>\n</div>\n\n<form id=\"bookingForm\">\n<div class=\"form-row\">\n<div class=\"field\">\n<label for=\"name\">Name</label>\n<input id=\"name\" name=\"name\" type=\"text\" placeholder=\"Your full name\" required>\n</div>\n<div class=\"field\">\n<label for=\"mobile\">Mobile</label>\n<input id=\"mobile\" name=\"mobile\" type=\"tel\" pattern=\"[0-9]{10}\" placeholder=\"10-digit mobile\" required>\n</div>\n</div>\n<div class=\"form-row\">\n<div class=\"field\">\n<label for=\"locationSelect\">Event Location (Select)</label>\n<select id=\"locationSelect\" name=\"location\" required>\n<option value=\"\" disabled selected>Select Location</option>\n<option value=\"Akbarpur (Akbarpur Tehsil)\">Akbarpur</option>\n<option value=\"Jalalpur (Jalalpur Tehsil)\">Jalalpur</option>\n<option value=\"Tanda (Tanda Tehsil)\">Tanda</option>\n<option value=\"Allapur (Allapur Tehsil)\">Allapur</option>\n<option value=\"Bhiti (Bhiti Tehsil)\">Bhiti</option>\n<option value=\"Rajesultanpur\">Rajesultanpur</option>\n<option value=\"Ashrafpur Kichhauchha\">Ashrafpur Kichhauchha</option>\n<option value=\"Malipur\">Malipur</option>\n<option value=\"Other\">Other (type below)</option>\n</select>\n<input id=\"locationOther\" class=\"other-input hidden\" type=\"text\" placeholder=\"Type your village / town name\">\n</div>\n<div class=\"field\">\n<label for=\"eventDate\">Event Date</label>\n<input id=\"eventDate\" name=\"eventDate\" type=\"date\" required>\n</div>\n</div>\n\n<div class=\"form-row\">\n<div class=\"field\">\n<label for=\"eventTime\">Event Time</label>\n<input id=\"eventTime\" name=\"eventTime\" type=\"time\" required>\n</div>\n<div class=\"field\">\n<label>&nbsp;</label>\n<button type=\"submit\" class=\"btn\" id=\"submitBooking\">Submit &amp; Open WhatsApp</button>\n</div>\n</div>\n\n<input type=\"hidden\" id=\"modalServicePrice\">\n<input type=\"hidden\" id=\"modalServiceIdHidden\">\n<input type=\"hidden\" id=\"modalVendorNameHidden\">\n<input type=\"hidden\" id=\"modalCategoryHidden\">\n</form>\n\n<p class=\"small\">\nIf WhatsApp doesn't open, we'll copy the message so you can paste it into WhatsApp manually.\n</p>\n</div>\n\n</div>\n\n<div class=\"modal-backdrop\" id=\"calcModalBackdrop\" role=\"dialog\" aria-modal=\"true\">\n  <div class=\"modal\" role=\"document\">\n    <button id=\"closeCalcModal\" style=\"float:right;background:transparent;border:none;font-size:16px;cursor:pointer\">\u2715</button>\n    <h3>Car Distance Price Calculator</h3>\n    <p class=\"small\">\n      Service: <span id=\"calcServiceTitle\" style=\"font-weight:600;color:var(--maroon)\"></span> \n      <span class=\"muted\">(<span id=\"calcServiceId\"></span>)</span>\n    </p>\n\n    <div style=\"background:var(--blush); padding:10px; border-radius:8px; margin-bottom:15px; font-size:13px;\">\n      <div style=\"margin-bottom:5px;\">\n        Car ID: <span id=\"calcDisplayId\" style=\"font-weight:600; color:var(--heading)\"></span>\n      </div>\n      <div style=\"margin-bottom:5px;\">\n        Base Price: <span id=\"calcDisplayBasePrice\" style=\"font-weight:600; color:var(--maroon)\"></span>\n      </div>\n      <div>\n        Price per KM: <span id=\"calcDisplayPricePerKm\" style=\"font-weight:600; color:var(--maroon)\"></span>\n      </div>\n    </div>\n    \n    <form id=\"calcForm\">\n      <div class=\"form-row\">\n        <div class=\"field\">\n          <label for=\"calcDistance\">Distance (in KM)</label>\n          <input id=\"calcDistance\" type=\"number\" min=\"1\" placeholder=\"e.g., 25\" required>\n        </div>\n        <div class=\"field\">\n          <label for=\"calcPickupLoc\">Pickup Location</label>\n          <input id=\"calcPickupLoc\" type=\"text\" placeholder=\"Village / Town Name\" required>\n        </div>\n      </div>\n      <div class=\"form-row\">\n        <div class=\"field\">\n          <label for=\"calcDestLoc\">Destination Location</label>\n          <input id=\"calcDestLoc\" type=\"text\" placeholder=\"Village / Town Name\" required>\n        </div>\n        <div class=\"field\">\n          <label>&nbsp;</label>\n          <button type=\"submit\" class=\"btn\" id=\"calculateBtn\">Calculate Price</button>\n        </div>\n      </div>\n    </form>\n    \n    <div id=\"calcResult\" class=\"hidden\" style=\"margin-top:15px; padding:10px; border:1px solid var(--maroon); border-radius:6px; background:white;\">\n      <div style=\"font-weight:600; color:var(--heading); margin-bottom:5px;\">Calculation Summary:</div>\n      <div id=\"calcResultBreakdown\" style=\"font-size:12px; color:var(--muted)\"></div>\n      <div style=\"margin-top:8px; font-size:15px; font-weight:700; color:var(--maroon);\">\n        Total Calculated Amount: <span id=\"calcTotalAmount\"></span>\n      </div>\n      <button id=\"bookCalculatedPriceBtn\" class=\"btn\" style=\"margin-top:10px; width:100%;\">Book with this Price</button>\n    </div>\n\n  </div>\n</div>\n\n<div class=\"modal-backdrop\" id=\"galleryModalBackdrop\" role=\"dialog\" aria-modal=\"true\">\n  <div class=\"modal gallery-modal\" role=\"document\" style=\"max-width: 80vw; padding: 10px;\">\n    <button id=\"closeGalleryModal\" style=\"position:absolute; top:5px; right:5px; background:transparent; border:none; font-size:20px; cursor:pointer; color: white; text-shadow: 0 0 5px black; z-index: 100;\">\u2715</button>\n    <div class=\"gallery-container\" id=\"galleryContainer\">\n      <button id=\"galleryPrev\" class=\"gallery-nav prev\">\u2039</button>\n      <div class=\"gallery-track\" id=\"galleryTrack\">\n        </div>\n      <button id=\"galleryNext\" class=\"gallery-nav next\">\u203a</button>\n    </div>\n    <div id=\"galleryCounter\" style=\"color:white; font-size:12px; text-align:center; margin-top:5px; text-shadow: 0 0 5px black;\"></div>\n  </div>\n</div>\n\n\n<footer>\n<div class=\"footer-grid\">\n<div>\n<div style=\"font-family:'Playfair Display',serif;font-size:18px;color:white\">\nJLPweds\n</div>\n<div class=\"muted\">\nCreating unforgettable moments for your special day with elegance and perfection.\n</div>\n</div>\n\n\n<div>\n<strong>Quick Links</strong>\n<ul style=\"list-style:none;padding:0;margin:8px 0 0\">\n<li><a href=\"#home\" style=\"color:rgba(255,255,255,0.9)\">Home</a></li>\n\n<li><a href=\"https://www.instagram.com/jlpweds?igsh=MXkxMTQ5YzVzdXAycg==\" style=\"color:rgba(255,255,255,0.9)\">Instagram</a></li>\n</ul>\n</div>\n<div>\n<strong>Contact</strong>\n<div class=\"muted\">\nEmail: jlpweds001@gmail.com\n</div>\n</div>\n</div>\n<div class=\"copyright\">\nCopyright \u00a9 2025 JLPweds. All rights reserved.\n</div>\n</footer>\n\n<script type=\"application/ld+json\">\n{\n  \"@context\": \"https://schema.org\",\n  \"@type\": \"LocalBusiness\",\n  \"name\": \"JLPweds\",\n  \"description\": \"JLPweds provides DJ services, wedding car rentals, hire videographers, Makeup artist, MarriagHall bookings and tent rentals in Jalalpur, Akbarpur, and Ambedkar Nagar District of Uttar Pradesh.\",\n  \"url\": \"https://jlpweds.in\",\n  \"telephone\": \"+91-7836998590\",\n  \"image\": \"https://jlpweds.in/assets/logo.png\",\n  \"address\": {\n    \"@type\": \"PostalAddress\",\n    \"streetAddress\": \"Near Main Market\",\n    \"addressLocality\": \"Jalalpur\",\n    \"addressRegion\": \"Ambedkar Nagar\",\n    \"postalCode\": \"224149\",\n    \"addressCountry\": \"IN\"\n  },\n  \"geo\": {\n    \"@type\": \"GeoCoordinates\",\n    \"latitude\": 26.3126306,\n    \"longitude\": 82.7328259\n  },\n  \"areaServed\": [\"Jalalpur\", \"Akbarpur\", \"Tanda\", \"Ashrafpur Kichhauchha\", \"Ambedkar Nagar\"],\n  \"serviceType\": [\n    \"DJ services for weddings\",\n    \"Tent rentals for weddings\",\n    \"Car rentals for weddings\"\n  ],\n  \"openingHours\": \"Mo-Su 12:00-23:59\",\n  \"sameAs\": [\n    \"https://www.instagram.com/jlpweds\"\n  ]\n}\n</script>\n\n<script src=\"./script.js\"></script>\n\n</body>\n\n\n</html>\n" }} />

      <script id="initial-data" type="application/json" dangerouslySetInnerHTML={{__html: JSON.stringify(vendorCategoriesJSON)}} />
      <script src="/script.js"></script>
    </>
  )
}

export async function getServerSideProps() {
  const { data: services } = await supabase
    .from('services')
    .select('*')
    .eq('status', 'approved')
    .order('created_at', { ascending: true })

  const categoriesMap = {}
  (services || []).forEach(s => {
    const cat = s.category || 'Other'
    if (!categoriesMap[cat]) categoriesMap[cat] = { category: cat, description: '', subcategories: [] }
    categoriesMap[cat].subcategories.push({
      serviceId: s.service_id,
      title: s.title,
      price: s.price,
      vendorName: s.vendor_name,
      location: s.location,
      description: s.description,
      basePrice: s.base_price,
      pricePerKm: s.price_per_km,
      images: s.images || []
    })
  })

  const vendorCategoriesJSON = Object.values(categoriesMap)
  return { props: { vendorCategoriesJSON } }
}
